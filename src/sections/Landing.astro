---
import InfoJobsLogo from '@/icons/InfojobsLogo.svg'

const techIcons = [
  'icon-angular',
  'icon-react',
  'icon-js',
  'icon-ts',
  'icon-vue',
  'icon-deno',
  'icon-node',
  'icon-bun',
  'icon-npm',
  'icon-pnpm',
  'icon-github',
  'icon-vscode',
  'icon-cursor',
  'icon-astro',
  'icon-next',
  'icon-svelte',
  'icon-vite',
  'icon-playwright',
]

// Create a randomized list of icons ensuring no two consecutive icons are the same
const generateRandomIcons = (count: number) => {
  const result: string[] = []
  let lastIcon = ''

  for (let i = 0; i < count; i++) {
    let randomIcon = ''
    do {
      randomIcon = techIcons[Math.floor(Math.random() * techIcons.length)]
    } while (randomIcon === lastIcon)

    result.push(randomIcon)
    lastIcon = randomIcon
  }
  return result
}

const backgroundIcons = generateRandomIcons(techIcons.length * 5)
---

<section
  id="home"
  class="min-h-[80vh] flex items-center justify-center relative bg-hero-radial pt-28 sm:pt-28 pb-10 overflow-hidden"
>
  <!-- Background Pattern of Tech Logos -->
  <div
    class="absolute inset-0 hidden min-[600px]:flex flex-wrap justify-center content-center gap-4 md:gap-[4vw] p-[2%] z-10 pointer-events-none mask-radial-faded"
  >
    {
      backgroundIcons.map((icon) => (
        <div
          class={`bg-icon ${icon} tech-icon w-6 h-6 md:w-10 md:h-10 bg-contain bg-no-repeat bg-center opacity-[0.04] grayscale transition-all duration-300 ease-out pointer-events-auto`}
        />
      ))
    }
  </div>

  <div
    class="absolute inset-x-0 bottom-0 h-40 bg-gradient-to-t from-dark-bg to-transparent z-10 pointer-events-none"
  >
  </div>

  <div class="container mx-auto px-5 relative z-40 text-center max-w-[900px] pointer-events-none">
    <div
      class="inline-flex items-center bg-white/10 px-6 py-3 rounded-full mb-8 border border-white/20 text-sm tracking-wide backdrop-blur-sm pointer-events-auto"
    >
      <span class="mr-2 opacity-70 font-bold">POWERED BY</span>

      <InfoJobsLogo class="h-6 w-auto -mb-1" />
    </div>
    <h1
      class="text-5xl lg:text-7xl font-bold font-display mb-4 tracking-tighter drop-shadow-[0_5px_15px_rgba(0,0,0,0.5)]"
    >
      JSCONF ESPAÑA 2026
    </h1>
    <div
      class="text-2xl text-js-yellow font-display font-medium mb-12 drop-shadow-[0_2px_10px_rgba(0,0,0,0.5)] text-balance"
    >
      <i class="far fa-calendar-alt mr-2"></i> 14 DE MARZO, 2026 &bull; MADRID &bull; LA NAVE
    </div>

    <!-- Countdown -->
    <div class="mb-12 pointer-events-auto">
      <p class="text-sm uppercase tracking-widest text-white/50 mb-4 font-bold">
        La conferencia empieza en
      </p>
      <div id="countdown" class="flex justify-center gap-3 sm:gap-5">
        <div class="flex flex-col items-center">
          <span
            id="countdown-days"
            class="text-4xl sm:text-5xl md:text-6xl font-black font-display text-js-yellow tabular-nums leading-none"
            >--</span
          >
          <span class="text-[10px] sm:text-xs uppercase tracking-wider text-white/40 mt-2 font-bold"
            >Días</span
          >
        </div>
        <span class="text-3xl sm:text-4xl md:text-5xl font-bold text-white/20 self-start">:</span>
        <div class="flex flex-col items-center">
          <span
            id="countdown-hours"
            class="text-4xl sm:text-5xl md:text-6xl font-black font-display text-js-yellow tabular-nums leading-none"
            >--</span
          >
          <span class="text-[10px] sm:text-xs uppercase tracking-wider text-white/40 mt-2 font-bold"
            >Horas</span
          >
        </div>
        <span class="text-3xl sm:text-4xl md:text-5xl font-bold text-white/20 self-start">:</span>
        <div class="flex flex-col items-center">
          <span
            id="countdown-minutes"
            class="text-4xl sm:text-5xl md:text-6xl font-black font-display text-js-yellow tabular-nums leading-none"
            >--</span
          >
          <span class="text-[10px] sm:text-xs uppercase tracking-wider text-white/40 mt-2 font-bold"
            >Min</span
          >
        </div>
        <span class="text-3xl sm:text-4xl md:text-5xl font-bold text-white/20 self-start">:</span>
        <div class="flex flex-col items-center">
          <span
            id="countdown-seconds"
            class="text-4xl sm:text-5xl md:text-6xl font-black font-display text-js-yellow tabular-nums leading-none"
            >--</span
          >
          <span class="text-[10px] sm:text-xs uppercase tracking-wider text-white/40 mt-2 font-bold"
            >Seg</span
          >
        </div>
      </div>
    </div>

    <!-- Social Run CTA -->
    <div class="pointer-events-auto max-w-lg mx-auto mb-8">
      <div
        class="relative bg-white/5 border border-white/10 rounded-2xl p-6 sm:p-8 backdrop-blur-sm hover:border-js-yellow/30 transition-all group"
      >
        <div class="absolute -top-3 left-1/2 -translate-x-1/2">
          <span
            class="bg-green-500 text-white text-[10px] sm:text-xs font-black uppercase tracking-widest px-4 py-1 rounded-full shadow-lg"
          >
            <i class="fas fa-gift mr-1.5"></i> Camiseta gratis
          </span>
        </div>
        <div class="flex items-center justify-center gap-3 mb-3">
          <i class="fas fa-running text-3xl text-js-yellow"></i>
          <h3
            class="text-xl sm:text-2xl font-black font-display uppercase tracking-tight text-white"
          >
            Social Run 5K
          </h3>
        </div>
        <p class="text-sm text-white/60 mb-1">
          <i class="fas fa-map-marker-alt mr-1.5 text-js-yellow/70"></i> Parque del Retiro, Madrid &bull;
          <i class="far fa-calendar-alt mr-1.5 ml-1 text-js-yellow/70"></i> 13 marzo · 17:30H
        </p>
        <p class="text-sm text-white/50 mb-5">
          Corre con la comunidad antes de la conferencia. Todos los niveles. ¡Camiseta técnica para
          todos los participantes!
        </p>
        <p class="text-sm text-js-yellow/90 mb-5 font-semibold">
          <i class="fas fa-users mr-1.5"></i>
          <span id="running-signups-count">...</span> personas ya apuntadas
        </p>
        <button
          id="open-running-signup"
          class="inline-flex items-center justify-center w-full px-6 py-3.5 font-bold uppercase tracking-wide text-sm bg-js-yellow text-js-black border-2 border-js-yellow rounded-lg hover:bg-js-black hover:text-js-yellow hover:shadow-[0_0_25px_rgba(247,223,30,0.4)] transition-all cursor-pointer"
        >
          <i class="fas fa-running mr-2"></i> ¡Apúntate al Running!
        </button>
      </div>
    </div>

    <!-- Lista de espera -->
    <div class="pointer-events-auto">
      <button
        id="buy-tickets-hero"
        class="inline-flex items-center gap-2 text-sm text-white/40 hover:text-white/70 transition-colors cursor-pointer group"
      >
        <i class="fas fa-ticket-alt text-xs"></i>
        <span
          class="border-b border-dashed border-white/20 group-hover:border-white/50 transition-colors"
          >¿Quieres entrada? Apúntate a la lista de espera</span
        >
      </button>
    </div>
  </div>
</section>

<script>
  // Countdown al evento: 14 marzo 2026 9:00 hora España (CET = UTC+1)
  const eventDate = new Date('2026-03-14T09:00:00+01:00')

  function updateCountdown() {
    const now = new Date()
    const diff = eventDate.getTime() - now.getTime()

    if (diff <= 0) {
      document.getElementById('countdown-days')!.textContent = '00'
      document.getElementById('countdown-hours')!.textContent = '00'
      document.getElementById('countdown-minutes')!.textContent = '00'
      document.getElementById('countdown-seconds')!.textContent = '00'
      return
    }

    const days = Math.floor(diff / (1000 * 60 * 60 * 24))
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60))
    const seconds = Math.floor((diff % (1000 * 60)) / 1000)

    document.getElementById('countdown-days')!.textContent = String(days).padStart(2, '0')
    document.getElementById('countdown-hours')!.textContent = String(hours).padStart(2, '0')
    document.getElementById('countdown-minutes')!.textContent = String(minutes).padStart(2, '0')
    document.getElementById('countdown-seconds')!.textContent = String(seconds).padStart(2, '0')
  }

  updateCountdown()
  setInterval(updateCountdown, 1000)

  // Running signup modal
  const openRunningBtn = document.getElementById('open-running-signup')
  openRunningBtn?.addEventListener('click', () => {
    window.dispatchEvent(new CustomEvent('open-running-signup'))
  })

  // Contador Social Run (CSR para no bloquear el render inicial)
  const runningSignupsCount = document.getElementById('running-signups-count')
  const updateRunningSignupsCount = async () => {
    if (!runningSignupsCount) return

    try {
      const response = await fetch('/api/running-signups-count', { cache: 'no-store' })
      if (!response.ok) throw new Error('No se pudo cargar el contador')
      const data = (await response.json()) as { count?: number }
      if (typeof data.count === 'number') {
        runningSignupsCount.textContent = data.count.toLocaleString('es-ES')
      } else {
        runningSignupsCount.textContent = '--'
      }
    } catch {
      runningSignupsCount.textContent = '--'
    }
  }
  updateRunningSignupsCount()
  window.addEventListener('running-signup-success', () => {
    updateRunningSignupsCount()
  })

  // Lista de espera
  const buyTicketsHero = document.getElementById('buy-tickets-hero')
  buyTicketsHero?.addEventListener('click', () => {
    window.dispatchEvent(new CustomEvent('open-ticket-tailor'))
  })

  // Efecto de proximidad para los iconos
  const icons = document.querySelectorAll('.tech-icon')
  const section = document.getElementById('home')
  const isDesktop = window.matchMedia('(min-width: 600px)')

  if (section && icons.length > 0) {
    section.addEventListener('mousemove', (e) => {
      if (!isDesktop.matches) return

      const rect = section.getBoundingClientRect()
      const mouseX = e.clientX - rect.left
      const mouseY = e.clientY - rect.top

      icons.forEach((icon) => {
        const iconRect = icon.getBoundingClientRect()
        const iconX = iconRect.left + iconRect.width / 2 - rect.left
        const iconY = iconRect.top + iconRect.height / 2 - rect.top

        const distance = Math.sqrt(Math.pow(mouseX - iconX, 2) + Math.pow(mouseY - iconY, 2))

        // Radio de efecto aumentado y curva más pronunciada
        const maxDistance = 300
        let proximity = Math.max(0, 1 - distance / maxDistance)
        // Hacer el efecto más evidente al acercarse (curva exponencial)
        proximity = Math.pow(proximity, 2)

        const htmlIcon = icon as HTMLElement

        if (proximity > 0) {
          // Opacidad: de 0.04 a 1 (máxima visibilidad al acercarse)
          const opacity = 0.04 + proximity * 0.96
          // Grayscale: de 100% a 0%
          const grayscale = 100 - proximity * 100
          // Escala: de 1 a 1.25
          const scale = 1 + proximity * 0.25
          // Brillo/Glow
          const glow = proximity * 15

          htmlIcon.style.opacity = opacity.toString()
          htmlIcon.style.filter = `grayscale(${grayscale}%) drop-shadow(0 0 ${glow}px rgba(247, 223, 30, ${proximity * 0.6}))`
          htmlIcon.style.transform = `scale(${scale})`
          htmlIcon.style.zIndex = '30'
        } else {
          htmlIcon.style.opacity = '0.04'
          htmlIcon.style.filter = 'grayscale(100%)'
          htmlIcon.style.transform = 'scale(1)'
          htmlIcon.style.zIndex = 'auto'
        }
      })
    })

    // Resetear al salir el ratón
    section.addEventListener('mouseleave', () => {
      if (!isDesktop.matches) return

      icons.forEach((icon) => {
        const htmlIcon = icon as HTMLElement
        htmlIcon.style.opacity = '0.04'
        htmlIcon.style.filter = 'grayscale(100%)'
        htmlIcon.style.transform = 'scale(1)'
        htmlIcon.style.zIndex = 'auto'
      })
    })
  }
</script>
